# CSL Certification Platform - Full Stack Architecture

## Table of Contents

- [CSL Certification Platform - Full Stack Architecture](#table-of-contents)
  - [Changelog](./changelog.md)
  - [1. Introduction](./1-introduction.md)
    - [Project Overview](./1-introduction.md#project-overview)
    - [Brownfield Project Status](./1-introduction.md#brownfield-project-status)
    - [Active Enhancement: Payment Gateway Centralization](./1-introduction.md#active-enhancement-payment-gateway-centralization)
  - [2. High Level Architecture](./2-high-level-architecture.md)
    - [2.1 Technical Summary](./2-high-level-architecture.md#21-technical-summary)
    - [2.2 Platform Choice](./2-high-level-architecture.md#22-platform-choice)
    - [2.3 Repository Structure](./2-high-level-architecture.md#23-repository-structure)
    - [2.4 High Level Architecture Diagram](./2-high-level-architecture.md#24-high-level-architecture-diagram)
    - [2.5 Architectural Patterns](./2-high-level-architecture.md#25-architectural-patterns)
  - [3. Tech Stack](./3-tech-stack.md)
    - [3.1 Technology Stack Table](./3-tech-stack.md#31-technology-stack-table)
  - [4. Data Models](./4-data-models.md)
    - [4.1 Core Models](./4-data-models.md#41-core-models)
      - [User](./4-data-models.md#user)
      - [Environment](./4-data-models.md#environment)
      - [Course](./4-data-models.md#course)
      - [Product](./4-data-models.md#product)
      - [Order](./4-data-models.md#order)
      - [Transaction](./4-data-models.md#transaction)
      - [PaymentGatewaySetting](./4-data-models.md#paymentgatewaysetting)
      - [Commission (Platform Fee Rates)](./4-data-models.md#commission-platform-fee-rates)
    - [4.2 NEW Models (Payment Gateway Centralization Epic)](./4-data-models.md#42-new-models-payment-gateway-centralization-epic)
      - [EnvironmentPaymentConfig (NEW)](./4-data-models.md#environmentpaymentconfig-new)
      - [InstructorCommission (NEW - Instructor Payout Records)](./4-data-models.md#instructorcommission-new-instructor-payout-records)
      - [WithdrawalRequest (NEW)](./4-data-models.md#withdrawalrequest-new)
  - [5. API Specification](./5-api-specification.md)
    - [5.1 API Overview](./5-api-specification.md#51-api-overview)
    - [5.2 Authentication](./5-api-specification.md#52-authentication)
    - [5.3 Core API Endpoints](./5-api-specification.md#53-core-api-endpoints)
      - [5.3.1 Authentication Endpoints](./5-api-specification.md#531-authentication-endpoints)
      - [5.3.2 Course Management Endpoints](./5-api-specification.md#532-course-management-endpoints)
      - [5.3.3 Product & E-commerce Endpoints](./5-api-specification.md#533-product-e-commerce-endpoints)
      - [5.3.4 Payment & Transaction Endpoints](./5-api-specification.md#534-payment-transaction-endpoints)
      - [5.3.5 Payment Gateway Management Endpoints](./5-api-specification.md#535-payment-gateway-management-endpoints)
    - [5.4 NEW API Endpoints (Payment Gateway Centralization Epic)](./5-api-specification.md#54-new-api-endpoints-payment-gateway-centralization-epic)
      - [5.4.1 Admin Commission Management Endpoints](./5-api-specification.md#541-admin-commission-management-endpoints)
      - [5.4.2 Admin Withdrawal Management Endpoints](./5-api-specification.md#542-admin-withdrawal-management-endpoints)
      - [5.4.3 Admin Environment Payment Config Endpoints](./5-api-specification.md#543-admin-environment-payment-config-endpoints)
      - [5.4.4 Admin Centralized Transaction Endpoints](./5-api-specification.md#544-admin-centralized-transaction-endpoints)
      - [5.4.5 Instructor Earnings Endpoints](./5-api-specification.md#545-instructor-earnings-endpoints)
      - [5.4.6 Instructor Withdrawal Endpoints](./5-api-specification.md#546-instructor-withdrawal-endpoints)
      - [5.4.7 Instructor Payment Config Endpoints](./5-api-specification.md#547-instructor-payment-config-endpoints)
    - [5.5 Example Requests & Responses](./5-api-specification.md#55-example-requests-responses)
      - [Example 1: Create Withdrawal Request (Instructor)](./5-api-specification.md#example-1-create-withdrawal-request-instructor)
      - [Example 2: Approve Withdrawal (Admin)](./5-api-specification.md#example-2-approve-withdrawal-admin)
      - [Example 3: Toggle Centralized Gateway (Admin)](./5-api-specification.md#example-3-toggle-centralized-gateway-admin)
    - [5.6 Error Responses](./5-api-specification.md#56-error-responses)
  - [6. Components](./6-components.md)
    - [6.1 Component Architecture Overview](./6-components.md#61-component-architecture-overview)
    - [6.2 Backend Components (Laravel)](./6-components.md#62-backend-components-laravel)
      - [6.2.1 PaymentService](./6-components.md#621-paymentservice)
      - [6.2.2 CommissionService](./6-components.md#622-commissionservice)
      - [6.2.3 EnvironmentPaymentConfigService (NEW)](./6-components.md#623-environmentpaymentconfigservice-new)
      - [6.2.4 InstructorCommissionService (NEW)](./6-components.md#624-instructorcommissionservice-new)
      - [6.2.5 WithdrawalService (NEW)](./6-components.md#625-withdrawalservice-new)
      - [6.2.6 PaymentGatewayFactory](./6-components.md#626-paymentgatewayfactory)
      - [6.2.7 BrandingService](./6-components.md#627-brandingservice)
      - [6.2.8 CertificateGenerationService](./6-components.md#628-certificategenerationservice)
    - [6.3 Frontend Components (Next.js)](./6-components.md#63-frontend-components-nextjs)
      - [6.3.1 AuthProvider (Context Provider)](./6-components.md#631-authprovider-context-provider)
      - [6.3.2 UI Component Library (Radix UI + TailwindCSS)](./6-components.md#632-ui-component-library-radix-ui-tailwindcss)
      - [6.3.3 Data Table Component](./6-components.md#633-data-table-component)
      - [6.3.4 Course Management Components](./6-components.md#634-course-management-components)
      - [6.3.5 Payment Components](./6-components.md#635-payment-components)
      - [6.3.6 Admin Commission Management Components (NEW)](./6-components.md#636-admin-commission-management-components-new)
      - [6.3.7 Admin Withdrawal Management Components (NEW)](./6-components.md#637-admin-withdrawal-management-components-new)
      - [6.3.8 Instructor Earnings Components (NEW)](./6-components.md#638-instructor-earnings-components-new)
      - [6.3.9 Instructor Withdrawal Components (NEW)](./6-components.md#639-instructor-withdrawal-components-new)
    - [6.4 Component Interaction Diagram](./6-components.md#64-component-interaction-diagram)
    - [6.5 Component Design Patterns](./6-components.md#65-component-design-patterns)
  - [7. External APIs](./7-external-apis.md)
    - [7.1 External API Overview](./7-external-apis.md#71-external-api-overview)
    - [7.2 Payment Gateway APIs](./7-external-apis.md#72-payment-gateway-apis)
      - [7.2.1 Stripe API](./7-external-apis.md#721-stripe-api)
      - [7.2.2 MonetBil API](./7-external-apis.md#722-monetbil-api)
      - [7.2.3 PayPal API](./7-external-apis.md#723-paypal-api)
      - [7.2.4 Lygos API](./7-external-apis.md#724-lygos-api)
    - [7.3 Email Delivery Services](./7-external-apis.md#73-email-delivery-services)
      - [7.3.1 Postmark API](./7-external-apis.md#731-postmark-api)
      - [7.3.2 Mailjet API (Alternative)](./7-external-apis.md#732-mailjet-api-alternative)
    - [7.4 Notification Services](./7-external-apis.md#74-notification-services)
      - [7.4.1 Telegram Bot API](./7-external-apis.md#741-telegram-bot-api)
      - [7.4.2 Slack API (Alternative)](./7-external-apis.md#742-slack-api-alternative)
    - [7.5 File Storage Services](./7-external-apis.md#75-file-storage-services)
      - [7.5.1 AWS S3 API (Optional)](./7-external-apis.md#751-aws-s3-api-optional)
      - [7.5.2 Local File Storage (Default)](./7-external-apis.md#752-local-file-storage-default)
    - [7.6 External API Security](./7-external-apis.md#76-external-api-security)
    - [7.7 External API Integration Diagram](./7-external-apis.md#77-external-api-integration-diagram)
  - [8. Core Workflows](./8-core-workflows.md)
    - [8.1 Workflow Overview](./8-core-workflows.md#81-workflow-overview)
    - [8.2 User Authentication Flow](./8-core-workflows.md#82-user-authentication-flow)
    - [8.3 Course Checkout & Payment Flow (Existing)](./8-core-workflows.md#83-course-checkout-payment-flow-existing)
    - [8.4 Centralized Payment Gateway Routing (NEW)](./8-core-workflows.md#84-centralized-payment-gateway-routing-new)
    - [8.5 Commission Record Creation (NEW)](./8-core-workflows.md#85-commission-record-creation-new)
    - [8.6 Instructor Withdrawal Request Flow (NEW)](./8-core-workflows.md#86-instructor-withdrawal-request-flow-new)
    - [8.7 Admin Withdrawal Approval Flow (NEW)](./8-core-workflows.md#87-admin-withdrawal-approval-flow-new)
    - [8.8 Course Enrollment & Certificate Generation](./8-core-workflows.md#88-course-enrollment-certificate-generation)
    - [8.9 Error Handling Patterns](./8-core-workflows.md#89-error-handling-patterns)
  - [9. Database Schema](./9-database-schema.md)
    - [9.1 Database Overview](./9-database-schema.md#91-database-overview)
    - [9.2 Entity Relationship Diagram (Core Entities)](./9-database-schema.md#92-entity-relationship-diagram-core-entities)
    - [9.3 Core Tables](./9-database-schema.md#93-core-tables)
      - [9.3.1 environments](./9-database-schema.md#931-environments)
      - [9.3.2 users](./9-database-schema.md#932-users)
      - [9.3.3 environment_user (Pivot Table)](./9-database-schema.md#933-environmentuser-pivot-table)
      - [9.3.4 courses](./9-database-schema.md#934-courses)
      - [9.3.5 products](./9-database-schema.md#935-products)
      - [9.3.6 orders](./9-database-schema.md#936-orders)
      - [9.3.7 transactions](./9-database-schema.md#937-transactions)
      - [9.3.8 payment_gateway_settings](./9-database-schema.md#938-paymentgatewaysettings)
      - [9.3.9 commissions (Platform Fee Rates)](./9-database-schema.md#939-commissions-platform-fee-rates)
    - [9.4 NEW Tables (Payment Gateway Centralization Epic)](./9-database-schema.md#94-new-tables-payment-gateway-centralization-epic)
      - [9.4.1 environment_payment_configs (NEW)](./9-database-schema.md#941-environmentpaymentconfigs-new)
      - [9.4.2 instructor_commissions (NEW)](./9-database-schema.md#942-instructorcommissions-new)
      - [9.4.3 withdrawal_requests (NEW)](./9-database-schema.md#943-withdrawalrequests-new)
    - [9.5 Indexes & Performance Optimization](./9-database-schema.md#95-indexes-performance-optimization)
    - [9.6 Database Migration Strategy](./9-database-schema.md#96-database-migration-strategy)
  - [10. Frontend Architecture](./10-frontend-architecture.md)
    - [10.1 Frontend Overview](./10-frontend-architecture.md#101-frontend-overview)
    - [10.2 CSL-Certification Frontend Architecture](./10-frontend-architecture.md#102-csl-certification-frontend-architecture)
      - [10.2.1 Application Structure](./10-frontend-architecture.md#1021-application-structure)
      - [10.2.2 Provider Hierarchy](./10-frontend-architecture.md#1022-provider-hierarchy)
      - [10.2.3 Routing Architecture](./10-frontend-architecture.md#1023-routing-architecture)
      - [10.2.4 State Management Strategy](./10-frontend-architecture.md#1024-state-management-strategy)
      - [10.2.5 Data Fetching Patterns](./10-frontend-architecture.md#1025-data-fetching-patterns)
      - [10.2.6 Authentication Flow](./10-frontend-architecture.md#1026-authentication-flow)
      - [10.2.7 Component Architecture](./10-frontend-architecture.md#1027-component-architecture)
      - [10.2.8 Form Handling](./10-frontend-architecture.md#1028-form-handling)
      - [10.2.9 Real-Time Features](./10-frontend-architecture.md#1029-real-time-features)
    - [10.3 CSL-Sales-Website Frontend Architecture](./10-frontend-architecture.md#103-csl-sales-website-frontend-architecture)
      - [10.3.1 Application Structure](./10-frontend-architecture.md#1031-application-structure)
      - [10.3.2 Authentication (Clerk)](./10-frontend-architecture.md#1032-authentication-clerk)
      - [10.3.3 UI Architecture](./10-frontend-architecture.md#1033-ui-architecture)
    - [10.4 Shared Frontend Patterns](./10-frontend-architecture.md#104-shared-frontend-patterns)
      - [10.4.1 UI Component Library (Radix UI + shadcn/ui)](./10-frontend-architecture.md#1041-ui-component-library-radix-ui-shadcnui)
      - [10.4.2 Styling Strategy](./10-frontend-architecture.md#1042-styling-strategy)
      - [10.4.3 Error Handling](./10-frontend-architecture.md#1043-error-handling)
      - [10.4.4 Performance Optimizations](./10-frontend-architecture.md#1044-performance-optimizations)
    - [10.5 Frontend Architecture Diagram](./10-frontend-architecture.md#105-frontend-architecture-diagram)
    - [10.6 Frontend Technology Versions](./10-frontend-architecture.md#106-frontend-technology-versions)
  - [11. Backend Architecture](./11-backend-architecture.md)
    - [11.1 Backend Overview](./11-backend-architecture.md#111-backend-overview)
    - [11.2 Directory Structure](./11-backend-architecture.md#112-directory-structure)
    - [11.3 Request Lifecycle](./11-backend-architecture.md#113-request-lifecycle)
    - [11.4 Service Layer Architecture](./11-backend-architecture.md#114-service-layer-architecture)
    - [11.5 Multi-Tenant Architecture](./11-backend-architecture.md#115-multi-tenant-architecture)
    - [11.6 Authentication & Authorization](./11-backend-architecture.md#116-authentication-authorization)
    - [11.7 Payment Gateway Factory Pattern](./11-backend-architecture.md#117-payment-gateway-factory-pattern)
    - [11.8 Event-Driven Architecture](./11-backend-architecture.md#118-event-driven-architecture)
    - [11.9 Queue & Job Processing](./11-backend-architecture.md#119-queue-job-processing)
    - [11.10 Middleware Stack](./11-backend-architecture.md#1110-middleware-stack)
    - [11.11 API Resource Transformation](./11-backend-architecture.md#1111-api-resource-transformation)
    - [11.12 Caching Strategy](./11-backend-architecture.md#1112-caching-strategy)
    - [11.13 Database Query Optimization](./11-backend-architecture.md#1113-database-query-optimization)
    - [11.14 Logging & Debugging](./11-backend-architecture.md#1114-logging-debugging)
    - [11.15 Broadcasting (Real-Time)](./11-backend-architecture.md#1115-broadcasting-real-time)
  - [12. Unified Project Structure](./12-unified-project-structure.md)
    - [12.1 Polyrepo Architecture](./12-unified-project-structure.md#121-polyrepo-architecture)
    - [12.2 Common File Patterns](./12-unified-project-structure.md#122-common-file-patterns)
    - [12.3 Shared Conventions](./12-unified-project-structure.md#123-shared-conventions)
  - [13. Development Workflow](./13-development-workflow.md)
    - [13.1 Local Development Setup](./13-development-workflow.md#131-local-development-setup)
    - [13.2 Git Workflow](./13-development-workflow.md#132-git-workflow)
    - [13.3 Code Review Process](./13-development-workflow.md#133-code-review-process)
    - [13.4 Testing Workflow](./13-development-workflow.md#134-testing-workflow)
  - [14. Deployment Architecture](./14-deployment-architecture.md)
    - [14.1 Infrastructure Overview](./14-deployment-architecture.md#141-infrastructure-overview)
    - [14.2 Docker Compose Setup](./14-deployment-architecture.md#142-docker-compose-setup)
    - [14.3 Deployment Process](./14-deployment-architecture.md#143-deployment-process)
  - [15. Security and Performance](./15-security-and-performance.md)
    - [15.1 Security Best Practices](./15-security-and-performance.md#151-security-best-practices)
    - [15.2 Performance Optimizations](./15-security-and-performance.md#152-performance-optimizations)
  - [16. Testing Strategy](./16-testing-strategy.md)
    - [16.1 Test Pyramid](./16-testing-strategy.md#161-test-pyramid)
    - [16.2 Backend Testing (Laravel)](./16-testing-strategy.md#162-backend-testing-laravel)
    - [16.3 Frontend Testing](./16-testing-strategy.md#163-frontend-testing)
  - [17. Coding Standards](./17-coding-standards.md)
    - [17.1 PHP (PSR-12)](./17-coding-standards.md#171-php-psr-12)
    - [17.2 TypeScript/JavaScript (ESLint)](./17-coding-standards.md#172-typescriptjavascript-eslint)
  - [18. Error Handling Strategy](./18-error-handling-strategy.md)
    - [18.1 Backend Error Handling](./18-error-handling-strategy.md#181-backend-error-handling)
  - [19. Monitoring and Observability](./19-monitoring-and-observability.md)
    - [19.1 Application Monitoring](./19-monitoring-and-observability.md#191-application-monitoring)
    - [19.2 Logging](./19-monitoring-and-observability.md#192-logging)
  - [20. Checklist Results Report](./20-checklist-results-report.md)
    - [20.1 Architecture Document Completeness](./20-checklist-results-report.md#201-architecture-document-completeness)
    - [20.2 Quality Metrics](./20-checklist-results-report.md#202-quality-metrics)
    - [20.3 Known Gaps & Future Work](./20-checklist-results-report.md#203-known-gaps-future-work)
  - [Document Metadata](./document-metadata.md)
